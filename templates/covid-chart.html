{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load core_tags %}

{% block title %}{% blocktrans %} COVID-19 {{ key }} chart {% endblocktrans %}{% endblock title %}
{% block description %}{% blocktrans %} COVID-19 {{ key }} chart {% endblocktrans %}{% endblock description %}
{% block og-title %}{% blocktrans %} COVID-19 {{ key }} chart {% endblocktrans %}{% endblock og-title %}
{% block og-description %}{% blocktrans %} COVID-19 {{ key }} chart {% endblocktrans %}{% endblock og-description %}

{% block content %}
<div class="chart-page container mt-9">
    <h1 class="display-5 text-center col-sm"><wbr>{% blocktrans %} COVID-19 {{ key }} chart {% endblocktrans %}</h1>
    <div class="row">
        <div class="tab-content col-sm-12" id="charts-content">
            <div class="tab-pane fade show active" id="chart">
                <canvas id="chart-canv" width="400" height="300"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        let stats_wiki = {{ data|safe }};
        let ctx_stats_wiki = document.getElementById('chart-canv').getContext('2d');

        function chart(ctx, data) {
            let country;
            let color;
            let _date;
            let stats_per_country;
            let lineChartData = {datasets: []};

            for (country in data) {
                stats_per_country = [];

                for (_date in data[country]) {
                    stats_per_country.push({
                        "x": new Date(_date),
                        "y": data[country][_date]
                    });
                }

                color = "#" + ((1 << 24)*Math.random() | 0).toString(16);

                lineChartData['datasets'].push({
                    label: country,
                    borderColor: color,
                    backgroundColor: color,
                    fill: false,
                    data: stats_per_country,
                    yAxisID: 'y-axis-1',
                });
            }

            Chart.Line(ctx, {
                data: lineChartData,
                options: {
                    responsive: true,
                    hoverMode: 'index',
                    stacked: false,
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                parser: 'YYYY-MM-DD',
                                tooltipFormat: 'll',
                                unit: 'day',
                            },
                            scaleLabel: {
                                display: true,
                                labelString: '{% trans "Date" %}'
                            }
                        }],
                        yAxes: [{
                            type: 'linear',
                            display: true,
                            position: 'left',
                            ticks: {
                                fontColor: 'rgb(255, 99, 132)'
                            },
                            id: 'y-axis-1',
                        }],
                    }
                }
            });
        }

        chart(ctx_stats_wiki, stats_wiki);
    });
</script>
{% endblock script %}
