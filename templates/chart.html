{% extends 'base.html' %}
{% load static from staticfiles %}
{% load i18n %}

{% block title %}{{ map.title }}{% endblock title %}
{% block description %}{{ map.description|default:_("No description provided") }}{% endblock description %}

{% block content %}
  <div>
      <div class="clearfix d-flex flex-column flex-sm-row">
        <h1 class="display-5 text-center col-sm"><wbr>{{ chart.title }}</h1>
        {% if request.user.is_superuser %}
          <a href="/admin/core/chart/{{ chart.pk }}/change/" class="float-right btn btn-outline-primary edit-map hidden-print">{% trans "Edit" %}</a>
        {% endif %}
      </div>
      <div class="row">
          <div class="col-md-12">
              <div id="charts" class="mt-4"></div>
          </div>
      </div>
  </div>
{% endblock content %}
{% block script %}
    <script type="text/javascript" src="{% static 'bower_components/highcharts/highcharts.js' %}"></script>
    <script>
        var titles = {{ titles|safe }};
        var data = {{ data|safe }};
        var unsorted_data;
        var names;
        var csv_data;
        var i;

        Highcharts.chart('charts', {
            chart: {
                height: 20 * Object.keys(titles).length,
                type: 'bar'
            },
            title: {
                text: '{{ chart.title }}'
            },
            xAxis: {
                categories: Object.keys(titles).map(function (key) {
                    return titles[key];
                })
            },
            yAxis: {
                min: {{ data_min }},
                title: {
                    text: '{{ chart.title }}'
                }
            },
            legend: {
                reversed: true
            },
            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },
            series: data
        });
    </script>
{% endblock script %}
